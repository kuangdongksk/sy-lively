import { Eæ—¶é—´æ ¼å¼åŒ– } from "@/constant/é…ç½®å¸¸é‡";
import { Iäº‹é¡¹ } from "@/pages/ä¸»é¡µ/components/äº‹é¡¹æ ‘/components/äº‹é¡¹";
import dayjs from "dayjs";
import {
  TKramdownAttr,
  ç”Ÿæˆæ®µè½å—,
  ç”Ÿæˆè¶…çº§å—,
  ç”Ÿæˆè¶…çº§å—Kramdownå¸¦å±æ€§,
} from "./åŸºç¡€";

export function æ ¹æ®äº‹é¡¹ç”Ÿæˆä¿¡æ¯å—(äº‹é¡¹: Iäº‹é¡¹) {
  return `${äº‹é¡¹.åç§°}[${äº‹é¡¹.ID.slice(0, 6)}]()é‡è¦ç¨‹åº¦${
    äº‹é¡¹.é‡è¦ç¨‹åº¦
  } ç´§æ€¥ç¨‹åº¦${äº‹é¡¹.ç´§æ€¥ç¨‹åº¦} å¼€å§‹æ—¶é—´${dayjs(äº‹é¡¹.å¼€å§‹æ—¶é—´).format(
    Eæ—¶é—´æ ¼å¼åŒ–.æ—¥è®°æ ¼å¼
  )}ç»“æŸæ—¶é—´${dayjs(äº‹é¡¹.ç»“æŸæ—¶é—´).format(Eæ—¶é—´æ ¼å¼åŒ–.æ—¥è®°æ ¼å¼)}`;
}

export function ç”Ÿæˆäº‹é¡¹å—Kramdown(äº‹é¡¹: Iäº‹é¡¹) {
  const ä¿¡æ¯å— = ç”Ÿæˆæ®µè½å—(æ ¹æ®äº‹é¡¹ç”Ÿæˆä¿¡æ¯å—(äº‹é¡¹), äº‹é¡¹.æ ‡é¢˜åŒºID);

  const å†…å®¹åŒº = ç”Ÿæˆè¶…çº§å—Kramdownå¸¦å±æ€§(
    [
      ç”Ÿæˆæ®µè½å—("ä»è¿™é‡Œå¼€å§‹(è¿™ä¸€è¡Œå†…å®¹å¯ä»¥æ›´æ”¹"),
      ç”Ÿæˆæ®µè½å—("ä¸è¦å†™åœ¨è¶…çº§å—å¤–è¾¹(è¿™ä¸€è¡Œå†…å®¹å¯ä»¥æ›´æ”¹"),
    ],
    äº‹é¡¹.å†…å®¹åŒºID
  );

  const äº‹é¡¹å— = ç”Ÿæˆè¶…çº§å—([ä¿¡æ¯å—, å†…å®¹åŒº]);
  console.log("ğŸš€ ~ ç”Ÿæˆäº‹é¡¹å—Kramdown ~ äº‹é¡¹å—:", äº‹é¡¹å—);

  return äº‹é¡¹å— + "\n" + æ ¹æ®äº‹é¡¹ç”Ÿæˆå±æ€§(äº‹é¡¹);
}

export function æ ¹æ®äº‹é¡¹ç”Ÿæˆå±æ€§(äº‹é¡¹: Iäº‹é¡¹): TKramdownAttr {
  const å±æ€§å­—ç¬¦ä¸² = Object.entries(äº‹é¡¹)
    .map(([key, value]) => {
      if (typeof value === "number") {
        return `&quot;${key}&quot;:${value}`;
      }
      return `&quot;${key}&quot;:&quot;${value}&quot;`;
    })
    .join(",");

  return `{: custom-plugin-lively-things="&#123;${å±æ€§å­—ç¬¦ä¸²}&#125;" id="${
    äº‹é¡¹.ID
  }" updated="${dayjs().format(Eæ—¶é—´æ ¼å¼åŒ–.æ€æºæ—¶é—´)}"}`;
}
